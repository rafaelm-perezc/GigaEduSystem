<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;">
    <title>Mis Calificaciones | Giga-Edu</title>
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="/sweetalert2/sweetalert2.all.min.js"></script>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-primary shadow-sm">
    <div class="container">
        <span class="navbar-brand mb-0 h1">Portal del Estudiante</span>
        <a href="/dashboard" class="btn btn-outline-light btn-sm">Volver al Men√∫</a>
    </div>
</nav>

<div class="container mt-4">
    <% if (error) { %>
        <script>
            Swal.fire('Informaci√≥n', '<%= error %>', 'info');
        </script>
    <% } else { %>
        <div class="row mb-4">
            <div class="col-md-12">
                <h3 class="text-secondary">Estudiante: <span class="text-dark fw-bold"><%= usuario.nombres %> <%= usuario.apellidos %></span></h3>
                <h5 class="text-muted">Grado Actual: <%= matricula.grado %> - <%= matricula.nomenclatura %></h5>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-white h-100">
                    <div class="card-body text-center">
                        <h1 class="display-4 mb-0">üèÜ</h1>
                        <h5 class="text-muted mt-2">Puesto en el Grupo</h5>
                        <% if(ranking && ranking.promedio_general > 0) { %>
                            <h2 class="fw-bold text-primary mb-0"><%= ranking.puesto_grupo %> <span class="fs-5 text-muted">/ <%= ranking.total_grupo %></span></h2>
                        <% } else { %>
                            <h5 class="text-warning mt-3">Sin notas registradas</h5>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-dark text-white h-100">
                    <div class="card-body text-center">
                        <h1 class="display-4 mb-0">üìà</h1>
                        <h5 class="text-white-50 mt-2">Promedio Acumulado</h5>
                        <% if(ranking && ranking.promedio_general > 0) { %>
                            <h2 class="fw-bold mb-0"><%= ranking.promedio_general.toFixed(2) %></h2>
                        <% } else { %>
                            <h5 class="text-warning mt-3">Pendiente</h5>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm border-0 bg-white h-100">
                    <div class="card-body text-center">
                        <h1 class="display-4 mb-0">üè´</h1>
                        <h5 class="text-muted mt-2">Puesto Institucional</h5>
                        <% if(ranking && ranking.promedio_general > 0) { %>
                            <h2 class="fw-bold text-success mb-0"><%= ranking.puesto_institucion %> <span class="fs-5 text-muted">/ <%= ranking.total_institucion %></span></h2>
                        <% } else { %>
                            <h5 class="text-warning mt-3">Sin notas registradas</h5>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-0">
            <div class="card-header bg-dark text-white">Detalle de Calificaciones por Asignatura</div>
            <div class="card-body p-0">
                <table class="table table-hover table-striped mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>√Årea</th>
                            <th>Asignatura</th>
                            <th class="text-center">Nota Definitiva</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (notas.length === 0) { %>
                            <tr><td colspan="3" class="text-center py-4">A√∫n no tienes calificaciones registradas en este periodo.</td></tr>
                        <% } else { %>
                            <% notas.forEach(n => { %>
                                <tr>
                                    <td><%= n.area %></td>
                                    <td class="fw-bold"><%= n.asignatura %></td>
                                    <td class="text-center">
                                        <span class="badge <%= n.nota_definitiva >= 3.0 ? 'bg-success' : 'bg-danger' %> fs-6">
                                            <%= n.nota_definitiva ? n.nota_definitiva.toFixed(1) : 'S.N' %>
                                        </span>
                                    </td>
                                </tr>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    <% } %>
</div>

</body>
</html>